<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Games Plants Play</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Game Theory</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Games Theory: Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./GamesPlantsPlay.html">1. The Basic Plant Height Game</a>
    </li>
    <li>
      <a href="./Evolution1.html">2. Evolution of Plant Height</a>
    </li>
    <li>
      <a href="./Evolution2.html">3. Evolution in the Modified Plant Game</a>
    </li>
    <li>
      <a href="./SelfSacrifice.html">4. The Evolution of Altruism</a>
    </li>
    <li>
      <a href="./PlantHeightAltruism.html">5. The Plant Height Model with Kin Selection</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<!-- # Games Plants Play {.tabset} -->
<div id="the-plant-height-model-with-kin-selection"
class="section level2">
<h2>The Plant Height Model with Kin Selection</h2>
<p>Let us now assume that seeds do not disperse far so that new plants
grow next to their mother plant. Mother plants and their offspring share
the gene for tree height by common descent with probability <span
class="math inline">\(r\)</span>, the relatedness coefficient. The
payoff to a rare mutant with allele <span
class="math inline">\(h&#39;\)</span> is then given by</p>
<p><span class="math display">\[
\begin{align}
W(h&#39;, h)    &amp; = r w(h&#39;, h&#39;, h) + (1 - r)w(h&#39;, h, h)
\\
            &amp; = r f(h&#39;)g(h&#39;, h&#39;) + (1 -r)
f(h&#39;)g(h&#39;, h),
\end{align}
\]</span> where <span class="math inline">\(w(h&#39;, h_{\mathrm r},
h)\)</span> is the payoff to a focal plant with height <span
class="math inline">\(h&#39;\)</span> growing next to a plant with
height <span class="math inline">\(h_{\mathrm r}\)</span> in a
population where the height of the resident plants is <span
class="math inline">\(h\)</span>. With probability <span
class="math inline">\(r\)</span> the focal individual and the
interacting individual share the gene for plant height by common
descent, in which case <span class="math inline">\(h_{\mathrm
r}=h&#39;\)</span>, and with probability <span
class="math inline">\(1-r\)</span> the focal individual and the
interacting individual do not share the gene for plant height by common
descent, in which case <span class="math inline">\(h_{\mathrm
r}=h\)</span>.</p>
<p>For the moment, let us use the same functions <span
class="math inline">\(f\)</span> and <span
class="math inline">\(g\)</span> as in the unmodified plant height game,
namely</p>
<p><span class="math display">\[
f(h)=1-h^\alpha,
\]</span></p>
<p>and</p>
<p><span class="math display">\[
g(h&#39;, h)=P_L+\frac{P_H-P_L}{1+\exp\left(-\beta(h&#39; - h)\right)}.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(h) {<span class="co"># amount of leaf biomass as a function of tree height</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> h<span class="sc">^</span>alpha</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(h.m, h.r) {<span class="co"># photosynthetic rate as a function of difference in tree height</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  P.L <span class="sc">+</span> (P.H <span class="sc">-</span> P.L)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>beta<span class="sc">*</span>(h.m <span class="sc">-</span> h.r)))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>To determine whether selection favors increased values of <span
class="math inline">\(h\)</span>, we could take the partial derivative
of <span class="math inline">\(w(h&#39;, h)\)</span>, evaluated at <span
class="math inline">\(h&#39; = h\)</span>, with the aim to recover
Hamilton’s rule. Next, let us plot a PIP to investigate the effect of
kin selection on ESS tree height. For this, we compute invasion fitness,
here defined as the difference in payoff between mutant and
resident.</p>
<p><span class="math display">\[
\begin{align}
s(h&#39;, h) &amp; = W(h&#39;, h) - W(h, h)
\end{align}
\]</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="cf">function</span>(h.m, h.r) {<span class="co"># payoff</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  r <span class="sc">*</span> <span class="fu">f</span>(h.m) <span class="sc">*</span> <span class="fu">g</span>(h.m, h.m) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> r) <span class="sc">*</span> <span class="fu">f</span>(h.m) <span class="sc">*</span> <span class="fu">g</span>(h.m, h.r)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="cf">function</span>(h.m, h.r) {<span class="co"># invasion fitness defined as the difference in payoff</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">w</span>(h.m, h.r) <span class="sc">-</span> <span class="fu">w</span>(h.r, h.r)  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>P.L <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>P.H <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>PIP <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.005</span>), s)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the computes s(h&#39;, h) for all combinations of h&#39; and h</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(<span class="fu">t</span>(PIP), <span class="at">levels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;PIP&quot;</span>, <span class="at">las =</span> <span class="dv">2</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="st">&quot;resident height h&quot;</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;mutant height h&#39;&quot;</span>))</span></code></pre></div>
<p><img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>As we can see, kin selection reduces the ESS plant height from
approximately 0.62 to approximately 0.5.</p>
<p>We can understand this result by looking at the derivative</p>
<p><span class="math display">\[
\begin{align}
\frac{\partial W(h&#39;, h)}{\partial h&#39;}\bigg|_{h&#39; = h}
  &amp; =\frac{\partial}{\partial h&#39;} (W(h&#39;, h)w(h&#39;, h&#39;,
h) + w(h&#39;, h, h))\big|_{h&#39; = h} \\
  &amp; = \frac{\partial}{\partial h&#39;} (r f(h&#39;)g(h&#39;, h&#39;)
+ (1 -r) f(h&#39;)g(h&#39;, h))\big|_{h&#39; = h}, \\
\end{align}
\]</span></p>
<p>which becomes</p>
<p><span class="math display">\[
\begin{align}
\frac{\partial W(h&#39;, h)}{\partial h&#39;}\bigg|_{h&#39; = h}
  &amp; = \underbrace{\frac{\partial}{\partial
h&#39;}(f(h&#39;)g(h&#39;, h))}_{costs} + r
\underbrace{\frac{\partial}{\partial h}(g(h&#39;, h))}_{-benefits}.
\end{align}
\]</span></p>
<p>First, let us note that in the plant height game, growing <em>less
tall</em> can be considered an act of altruism (if the costs of doing so
are positive) or an act of cooperation (if the costs of doing so are
negative). This is the reason why in the above equation, the first term
is defined as <span class="math inline">\(c\)</span> and the second term
as <span class="math inline">\(-b\)</span> (compare with the
corresponding equation in the self-sacrificing game). The cost-term
describes the effect of changing the strategy value <span
class="math inline">\(h&#39;\)</span> of the actor on the payoff of the
actor itself. This term is negative when the <span
class="math inline">\(h&#39;&gt;h^*\)</span>, where <span
class="math inline">\(h^*\)</span> is the evolutionary stable strategy
value in the absence of kin competition, and positive in the reverse
case. The benefit-term describes the effect of a trait change of the
interacting individual (the recipient) on the payoff of the actor. This
term is always negative (if the neighboring plant grows higher, the
focal individual is more shaded). This analysis shows that competition
with kin always selects for a lower ESS-value compared to the model
without kin selelction.</p>
<!--
## The Modified Plant Height Model with Kin Selection

Let us repeat this analysis but for the modified plant height game where minimum level of photosynthesis, $P_L$, is a function of the degree of shading. Earlier we defined this function as

$$
P_L(h', h) = P_{L, \mathrm{mean}} + P_{L, \mathrm{var}}\left(\frac{1}{1+\exp\left(\gamma(h' - h)\right)}- \frac{1}{2}\right),
$$


```r
P.L.flex <- function(h.m, h.r) {# P.L.flex is the name of the function that makes the minimum photosynthetic activity a function of the degree of shading of the leaves by the neighboring plant
  P.L.mean + P.L.var*(1 / (1 + exp(gamma*(h.m - h.r))) - 1/2)
}

# the parameter P.L.mean gives P.L when h'= h
P.L.mean <- 0.25

# next the parameter determining the maximum difference in P.L between
# completely shaded and maximally sun exposed
P.L.var <- 0.5

# finally the parameter determining how fast P.L increases with increased
# shading from a competitor
gamma <- 10 

curve(P.L.flex(x, h.r = 0.5), from = 0, to = 1, xlab = expression(height ~ "h'"), ylab = expression("minimum photosynthesis, " * P[L]("h'", h * "=0.5")))
```

<img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-3-1.png" width="672" />

This gives us a new function of the amount of photosynthesis per leave, as defined earlier.


```r
g.flex <- function(h.m, h.r) { # this a new function for g(h', h) that incorporates our new function for P.L
  P.L.flex(h.m, h.r) + (P.H - P.L.flex(h.m, h.r))/(1 + exp(-beta*(h.m - h.r)))
}

beta <- 5 # how fast does g change
P.H <- 1 # maximum photosynthesis (identical in both versions of the model)

g <- function(h.m, h.r) { # the old function g(h', h) for comparison
  P.L + (P.H - P.L)/(1 + exp(-beta*(h.m - h.r)))
}

P.L <- 0.25 # parameter determining the minimum photosynthesis in model with fixed P.L,
# here chosen to be equal to P.L.mean <- 0.25 for comparison

curve(g.flex(x, h.r = 0.5), from = 0, to = 1, xlab = expression("plant height, h'"), ylim = c(0,1), ylab = expression("photosythesis/leaf, g(h', h = 0.5)"), col = "blue")
curve(g(x, h.r = 0.5), from = 0, to = 1, col = "orange", add = TRUE)
legend("topleft", legend = c(expression(P[L] * " variable "),
                              expression(P[L] * " fixed ")), lty =1, col = c("blue", "orange"))
```

<img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-4-1.png" width="672" />

Let us put all this together to produce a PIP


```r
w <- function(h.m, h.r) {# payoff, now using the function g.flex
  r * f(h.m) * g.flex(h.m, h.m) + (1 - r) * f(h.m) * g.flex(h.m, h.r)
}

s <- function(h.m, h.r) {# invasion fitness defined as the difference in payoff
  w(h.m, h.r) - w(h.r, h.r)  
}
# Note that w(h.r, h.r) simplifies to f(h)g(h, h).

r <- 0.5
alpha <- 3
beta <- 5
P.L <- 0.25
P.H <- 1

PIP <- outer(seq(0, 1, 0.005), seq(0, 1, 0.005), s)
# the computes s(h', h) for all combinations of h' and h

par(pty="s")
filled.contour(t(PIP), levels = c(-1, 0, 1), main = "PIP", las = 2,
               xlab = expression("resident height h"),
               ylab = expression("mutant height h'"))
```

<img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-5-1.png" width="672" />

As we can see, in the modified plant height game, kin selection reduces the ESS plant height from approximately 0.42 to approximately 0.3.

In order to determine whether a mutant *p'* will replace the resident *p* or coexist with it, we plot the mirror image of a PIP (mirrored over the 45-degree line).


```r
s.flipped.roles <- function(h.m, h.r) {
  w(h.r, h.m) - w(h.m, h.m)
}

PIP.mirrored <- outer(seq(0, 1, 0.005), seq(0, 1, 0.005), s.flipped.roles)

par(pty="s")
filled.contour(t(PIP.mirrored), levels = c(-1, 0, 1), las = 2, main = "PIP.mirrored",
               xlab = expression("height h"),
               ylab = expression("height h'"))
```

<img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-6-1.png" width="672" />


```r
par(pty="s")
TEP <- ifelse(PIP > 0 & PIP.mirrored > 0, 1, ifelse(PIP < 0 & PIP.mirrored < 0, -1, 0))

filled.contour(t(TEP), levels = c(-1.5, -0.5, 0.5, 1.5), col = c("red", "blue", "green"),
plot.title={
  title(main = "PIP and PIP.mirrored superimposed")
  title(xlab=expression("height h"))
  title(ylab=expression("height h'"))
  abline(0, 1, lwd = 1)
})
```

<img src="PlantHeightAltruism_files/figure-html/unnamed-chunk-7-1.png" width="672" />

```r
# green area: mutual invadability resulting in coexistence
# blue area: one trait value can invade the other but not vice versa,
# resulting in fixation of one of the genotypes
```

The possibility for evolutionary branching does not seem to be affected by kin selection.
-->
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
